# –ù–∞—Å—Ç—Ä–æ–π–∫–∞ HTTPS —Å Caddy –∏ Let's Encrypt

–ü–æ–ª–Ω–æ–µ —Ä—É–∫–æ–≤–æ–¥—Å—Ç–≤–æ –ø–æ –Ω–∞—Å—Ç—Ä–æ–π–∫–µ HTTPS –¥–ª—è AgiCraft —Å –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–º–∏ SSL —Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç–∞–º–∏.

## –í–∞–∂–Ω–æ –ø–æ–Ω–∏–º–∞—Ç—å

### –ó–∞—á–µ–º –Ω—É–∂–µ–Ω HTTPS?

1. **–ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å:** –®–∏—Ñ—Ä–æ–≤–∞–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π (–ø–∞—Ä–æ–ª–∏, –ø–ª–∞—Ç–µ–∂–∏)
2. **–í–µ–±—Ö—É–∫–∏:** YooKassa, n8n –∏ –º–Ω–æ–≥–∏–µ –¥—Ä—É–≥–∏–µ —Å–µ—Ä–≤–∏—Å—ã —Ç—Ä–µ–±—É—é—Ç HTTPS –¥–ª—è –≤–µ–±—Ö—É–∫–æ–≤
3. **SEO:** Google —Ä–∞–Ω–∂–∏—Ä—É–µ—Ç HTTPS —Å–∞–π—Ç—ã –≤—ã—à–µ
4. **–î–æ–≤–µ—Ä–∏–µ:** –ó–µ–ª—ë–Ω–∞—è –ø–ª–∞—à–∫–∞ "–ó–∞—â–∏—â–µ–Ω–æ" –≤ –±—Ä–∞—É–∑–µ—Ä–µ

### –ß—Ç–æ –¥–µ–ª–∞–µ—Ç Caddy?

- **Reverse Proxy:** –ü–µ—Ä–µ–Ω–∞–ø—Ä–∞–≤–ª—è–µ—Ç –∑–∞–ø—Ä–æ—Å—ã –Ω–∞ frontend –∏ backend
- **–ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π SSL:** –ü–æ–ª—É—á–∞–µ—Ç –∏ –æ–±–Ω–æ–≤–ª—è–µ—Ç —Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç—ã –æ—Ç Let's Encrypt
- **HTTP ‚Üí HTTPS:** –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ —Ä–µ–¥–∏—Ä–µ–∫—Ç–∏—Ç –≤—Å–µ HTTP –∑–∞–ø—Ä–æ—Å—ã –Ω–∞ HTTPS

---

## –®–∞–≥ 1: –ü–æ–∫—É–ø–∫–∞ –¥–æ–º–µ–Ω–∞

### –ì–¥–µ –∫—É–ø–∏—Ç—å –¥–æ–º–µ–Ω?

–†–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è **reg.ru** (140‚ÇΩ/–≥–æ–¥)

**–ü—Ä–æ—Ü–µ—Å—Å –ø–æ–∫—É–ø–∫–∏:**

1. –û—Ç–∫—Ä—ã—Ç—å https://www.reg.ru/
2. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –¥–æ—Å—Ç—É–ø–Ω–æ—Å—Ç—å –¥–æ–º–µ–Ω–∞ (–Ω–∞–ø—Ä–∏–º–µ—Ä: `nettyan.ru`)
3. –ö—É–ø–∏—Ç—å –¥–æ–º–µ–Ω –Ω–∞ 1 –≥–æ–¥ (~140‚ÇΩ)
4. –ó–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞—Ç—å –∞–∫–∫–∞—É–Ω—Ç –∏–ª–∏ –≤–æ–π—Ç–∏
5. –û–ø–ª–∞—Ç–∏—Ç—å –¥–æ–º–µ–Ω

**–ü—Ä–∏–º–µ—Ä—ã –¥–æ–º–µ–Ω–æ–≤:**
- `nettyan.ru`
- `agicraft.ru`
- `minecraft-server.ru`

### –ê–ª—å—Ç–µ—Ä–Ω–∞—Ç–∏–≤—ã reg.ru

- **Cloudflare Registrar:** ~800‚ÇΩ/–≥–æ–¥ (.ru), –±–µ–∑ –∫–æ–º–∏—Å—Å–∏–π
- **Namecheap:** ~$10/–≥–æ–¥ (.com)
- **2domains.ru:** ~100-150‚ÇΩ/–≥–æ–¥ (.ru)

---

## –®–∞–≥ 2: –ü—Ä–∏–≤—è–∑–∫–∞ –¥–æ–º–µ–Ω–∞ –∫ IP –∞–¥—Ä–µ—Å—É

–ü–æ—Å–ª–µ –ø–æ–∫—É–ø–∫–∏ –¥–æ–º–µ–Ω–∞ –Ω—É–∂–Ω–æ –ø—Ä–∏–≤—è–∑–∞—Ç—å –µ–≥–æ –∫ –≤–∞—à–µ–º—É —Å–µ—Ä–≤–µ—Ä—É.

### –í –ª–∏—á–Ω–æ–º –∫–∞–±–∏–Ω–µ—Ç–µ reg.ru

1. –í–æ–π—Ç–∏ –≤ –ª–∏—á–Ω—ã–π –∫–∞–±–∏–Ω–µ—Ç reg.ru
2. –ü–µ—Ä–µ–π—Ç–∏ –≤ —Ä–∞–∑–¥–µ–ª "–ú–æ–∏ –¥–æ–º–µ–Ω—ã"
3. –í—ã–±—Ä–∞—Ç—å –∫—É–ø–ª–µ–Ω–Ω—ã–π –¥–æ–º–µ–Ω ‚Üí "–£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ"
4. –ü–µ—Ä–µ–π—Ç–∏ –≤ "DNS-—Å–µ—Ä–≤–µ—Ä—ã –∏ —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –∑–æ–Ω–æ–π"

### –î–æ–±–∞–≤–∏—Ç—å A-–∑–∞–ø–∏—Å–∏

**–î–æ–±–∞–≤—å—Ç–µ —Å–ª–µ–¥—É—é—â–∏–µ –∑–∞–ø–∏—Å–∏:**

| –¢–∏–ø | –ò–º—è | –ó–Ω–∞—á–µ–Ω–∏–µ | TTL |
|-----|-----|----------|-----|
| A | @ | –í–ê–®_IP_–ê–î–†–ï–° | 600 |
| A | www | –í–ê–®_IP_–ê–î–†–ï–° | 600 |

**–ü—Ä–∏–º–µ—Ä –¥–ª—è IP 188.242.12.214:**

```
A   @     188.242.12.214   600
A   www   188.242.12.214   600
```

### –ü—Ä–æ–≤–µ—Ä–∫–∞ DNS

DNS –º–æ–∂–µ—Ç –æ–±–Ω–æ–≤–ª—è—Ç—å—Å—è –æ—Ç **5 –º–∏–Ω—É—Ç –¥–æ 24 —á–∞—Å–æ–≤**. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –º–æ–∂–Ω–æ —Ç–∞–∫:

**Windows:**
```bash
nslookup nettyan.ru
```

**Linux/Mac:**
```bash
dig nettyan.ru +short
```

–î–æ–ª–∂–µ–Ω –≤–µ—Ä–Ω—É—Ç—å—Å—è –≤–∞—à IP –∞–¥—Ä–µ—Å: `188.242.12.214`

---

## –®–∞–≥ 3: –ù–∞—Å—Ç—Ä–æ–π–∫–∞ .env —Ñ–∞–π–ª–∞

**–í–ê–ñ–ù–û:** –ù–∞—Å—Ç—Ä–æ–π—Ç–µ `.env` **–î–û** –∑–∞–ø—É—Å–∫–∞ Caddy!

### –°–∫–æ–ø–∏—Ä–æ–≤–∞—Ç—å .env.example

```bash
cp .env.example .env
```

### –û—Ç—Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å .env

```env
# –î–æ–º–µ–Ω (–ë–ï–ó https://)
DOMAIN=nettyan.ru

# Email –¥–ª—è —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π Let's Encrypt
LETSENCRYPT_EMAIL=your_real_email@gmail.com

# Frontend URL (–° https://)
FRONTEND_URL=https://nettyan.ru

# YooKassa URLs (–° https://)
YOOKASSA_RETURN_URL=https://nettyan.ru/payment/success
YOOKASSA_WEBHOOK_URL=https://nettyan.ru/api/payment/webhook

# Production mode
NODE_ENV=production

# –ü–∞—Ä–æ–ª–∏ –∏ –∫–ª—é—á–∏
POSTGRES_PASSWORD=YourStrongPassword123!
JWT_SECRET=your_random_jwt_secret_key_min_32_chars
RCON_PASSWORD=YourRconPassword123!
YOOKASSA_SHOP_ID=123456
YOOKASSA_SECRET_KEY=test_xxxxxxxxxxxxx
```

### –í–∞–∂–Ω—ã–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ

- **DOMAIN:** –í–∞—à –¥–æ–º–µ–Ω –ë–ï–ó –ø—Ä–æ—Ç–æ–∫–æ–ª–∞ (–Ω–µ `https://`, –ø—Ä–æ—Å—Ç–æ `nettyan.ru`)
- **LETSENCRYPT_EMAIL:** –†–µ–∞–ª—å–Ω—ã–π email –¥–ª—è —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π –æ —Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç–∞—Ö
- **FRONTEND_URL:** –ü–æ–ª–Ω—ã–π URL –° –ø—Ä–æ—Ç–æ–∫–æ–ª–æ–º (`https://nettyan.ru`)

---

## –®–∞–≥ 4: –ü—Ä–æ–≤–µ—Ä–∫–∞ Caddyfile

**–§–∞–π–ª:** `caddy/Caddyfile`

–£–±–µ–¥–∏—Ç–µ—Å—å —á—Ç–æ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è –ø—Ä–∞–≤–∏–ª—å–Ω–∞—è:

```caddyfile
{$DOMAIN:localhost} {
    tls {$EMAIL:admin@example.com}

    # Frontend
    handle /* {
        reverse_proxy frontend:80
    }

    # Backend API
    handle /api/* {
        reverse_proxy backend:3000
    }
}
```

Caddy –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –ø–æ–¥—Å—Ç–∞–≤–∏—Ç –∑–Ω–∞—á–µ–Ω–∏—è –∏–∑ `.env`.

---

## –®–∞–≥ 5: –ù–∞—Å—Ç—Ä–æ–π–∫–∞ —Ä–æ—É—Ç–µ—Ä–∞ (–ø—Ä–æ–±—Ä–æ—Å –ø–æ—Ä—Ç–æ–≤)

### –û—Ç–∫—Ä—ã—Ç—å –ø–æ—Ä—Ç—ã –Ω–∞ —Ä–æ—É—Ç–µ—Ä–µ

**–ù–µ–æ–±—Ö–æ–¥–∏–º—ã–µ –ø–æ—Ä—Ç—ã:**

| –ü–æ—Ä—Ç | –ü—Ä–æ—Ç–æ–∫–æ–ª | –ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ |
|------|----------|------------|
| 80 | TCP | HTTP (—Ä–µ–¥–∏—Ä–µ–∫—Ç –Ω–∞ HTTPS) |
| 443 | TCP | HTTPS (–æ—Å–Ω–æ–≤–Ω–æ–π) |
| 8080 | TCP | HTTP –∞–ª—å—Ç–µ—Ä–Ω–∞—Ç–∏–≤–Ω—ã–π (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ) |
| 25565 | TCP/UDP | Minecraft Velocity |

### –ü—Ä–∏–º–µ—Ä –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ (TP-Link)

1. –û—Ç–∫—Ä—ã—Ç—å —Ä–æ—É—Ç–µ—Ä: `http://192.168.0.1`
2. –ü–µ—Ä–µ–π—Ç–∏: **Forwarding ‚Üí Virtual Servers**
3. –î–æ–±–∞–≤–∏—Ç—å –ø—Ä–∞–≤–∏–ª–∞:

```
Service Port: 80
Internal Port: 80
IP Address: 192.168.0.246
Protocol: TCP
Status: Enabled

Service Port: 443
Internal Port: 443
IP Address: 192.168.0.246
Protocol: TCP
Status: Enabled

Service Port: 8080
Internal Port: 8080
IP Address: 192.168.0.246
Protocol: TCP
Status: Enabled
```

### –ü—Ä–æ–≤–µ—Ä–∫–∞ –ø–æ—Ä—Ç–æ–≤

–ü–æ—Å–ª–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ –ø—Ä–æ–≤–µ—Ä—å—Ç–µ –æ—Ç–∫—Ä—ã—Ç–æ—Å—Ç—å –ø–æ—Ä—Ç–æ–≤:

```bash
# Online –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç
https://www.yougetsignal.com/tools/open-ports/

# –ò–ª–∏ —á–µ—Ä–µ–∑ telnet
telnet nettyan.ru 80
telnet nettyan.ru 443
```

---

## –®–∞–≥ 6: –ó–∞–ø—É—Å–∫ Caddy

**–í–ê–ñ–ù–û:** –ó–∞–ø—É—Å–∫–∞–π—Ç–µ Caddy **–¢–û–õ–¨–ö–û** –∫–æ–≥–¥–∞:
1. ‚úÖ –î–æ–º–µ–Ω –∫—É–ø–ª–µ–Ω
2. ‚úÖ DNS –Ω–∞—Å—Ç—Ä–æ–µ–Ω –∏ —Ä–∞–±–æ—Ç–∞–µ—Ç
3. ‚úÖ –ü–æ—Ä—Ç—ã 80 –∏ 443 –æ—Ç–∫—Ä—ã—Ç—ã
4. ‚úÖ `.env` —Ñ–∞–π–ª –Ω–∞—Å—Ç—Ä–æ–µ–Ω

### –ó–∞–ø—É—Å–∫ —Ç–æ–ª—å–∫–æ Caddy (–¥–ª—è —Ç–µ—Å—Ç–∞)

```bash
# –°–Ω–∞—á–∞–ª–∞ –∑–∞–ø—É—Å—Ç–∏—Ç–µ backend –∏ frontend
docker-compose up -d backend frontend

# –ü–æ–¥–æ–∂–¥–∏—Ç–µ 10 —Å–µ–∫—É–Ω–¥

# –ó–∞–ø—É—Å—Ç–∏—Ç–µ Caddy
docker-compose up -d caddy

# –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ª–æ–≥–∏
docker-compose logs -f caddy
```

### –ß—Ç–æ –¥–æ–ª–∂–Ω–æ –ø—Ä–æ–∏–∑–æ–π—Ç–∏

1. Caddy –∑–∞–ø—É—Å—Ç–∏—Ç—Å—è
2. –ü–æ–¥–∫–ª—é—á–∏—Ç—Å—è –∫ Let's Encrypt
3. –ü—Ä–æ–π–¥—ë—Ç HTTP-01 challenge (–ø—Ä–æ–≤–µ—Ä–∫–∞ —á–µ—Ä–µ–∑ –ø–æ—Ä—Ç 80)
4. –ü–æ–ª—É—á–∏—Ç SSL —Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç
5. –°–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç —Å–æ—Ö—Ä–∞–Ω–∏—Ç—Å—è –≤ `caddy/data/`

**–õ–æ–≥–∏ –ø—Ä–∏ —É—Å–ø–µ—Ö–µ:**

```
caddy | {"level":"info","ts":1699999999,"msg":"certificate obtained successfully"}
caddy | {"level":"info","ts":1699999999,"msg":"serving initial configuration"}
```

### –ï—Å–ª–∏ –≤–æ–∑–Ω–∏–∫–ª–∞ –æ—à–∏–±–∫–∞

**–û—à–∏–±–∫–∞: "acme: challenge failed"**

–ü—Ä–∏—á–∏–Ω—ã:
- DNS –µ—â—ë –Ω–µ –æ–±–Ω–æ–≤–∏–ª—Å—è (–ø–æ–¥–æ–∂–¥–∏—Ç–µ 1-24 —á–∞—Å–∞)
- –ü–æ—Ä—Ç 80 –Ω–µ –æ—Ç–∫—Ä—ã—Ç –Ω–∞ —Ä–æ—É—Ç–µ—Ä–µ
- –î–æ–º–µ–Ω –Ω–µ —É–∫–∞–∑—ã–≤–∞–µ—Ç –Ω–∞ –≤–∞—à IP

**–†–µ—à–µ–Ω–∏–µ:**

1. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ DNS: `nslookup nettyan.ru`
2. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ø–æ—Ä—Ç—ã: https://www.yougetsignal.com/tools/open-ports/
3. –ü–æ–¥–æ–∂–¥–∏—Ç–µ 1 —á–∞—Å –∏ –ø–æ–ø—Ä–æ–±—É–π—Ç–µ —Å–Ω–æ–≤–∞

```bash
# –û—Å—Ç–∞–Ω–æ–≤–∏—Ç—å Caddy
docker-compose stop caddy

# –£–¥–∞–ª–∏—Ç—å –¥–∞–Ω–Ω—ã–µ (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ, –µ—Å–ª–∏ –Ω—É–∂–Ω–æ –ø–æ–ª—É—á–∏—Ç—å —Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç –∑–∞–Ω–æ–≤–æ)
rm -rf caddy/data/*

# –ó–∞–ø—É—Å—Ç–∏—Ç—å —Å–Ω–æ–≤–∞ —á–µ—Ä–µ–∑ —á–∞—Å
docker-compose up -d caddy
```

---

## –®–∞–≥ 7: –ü–æ–ª–Ω—ã–π –∑–∞–ø—É—Å–∫ —Å–∏—Å—Ç–µ–º—ã

–ü–æ—Å–ª–µ —É—Å–ø–µ—à–Ω–æ–≥–æ –ø–æ–ª—É—á–µ–Ω–∏—è —Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç–∞:

```bash
# –û—Å—Ç–∞–Ω–æ–≤–∏—Ç—å –≤—Å—ë
docker-compose down

# –ó–∞–ø—É—Å—Ç–∏—Ç—å –≤–µ—Å—å —Å—Ç–µ–∫
docker-compose up -d

# –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —Å—Ç–∞—Ç—É—Å
docker-compose ps

# –í—Å–µ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä—ã –¥–æ–ª–∂–Ω—ã –±—ã—Ç—å "Up"
```

---

## –®–∞–≥ 8: –ü—Ä–æ–≤–µ—Ä–∫–∞ HTTPS

### –ü—Ä–æ–≤–µ—Ä–∫–∞ –≤ –±—Ä–∞—É–∑–µ—Ä–µ

1. –û—Ç–∫—Ä—ã—Ç—å: `https://nettyan.ru`
2. –î–æ–ª–∂–Ω–∞ –ø–æ—è–≤–∏—Ç—å—Å—è –≥–ª–∞–≤–Ω–∞—è —Å—Ç—Ä–∞–Ω–∏—Ü–∞ AgiCraft
3. –í –∞–¥—Ä–µ—Å–Ω–æ–π —Å—Ç—Ä–æ–∫–µ –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å –∑–∞–º–æ–∫ üîí
4. –ù–∞–∂–∞—Ç—å –Ω–∞ –∑–∞–º–æ–∫ ‚Üí "–°–æ–µ–¥–∏–Ω–µ–Ω–∏–µ –∑–∞—â–∏—â–µ–Ω–æ"

### –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ä–µ–¥–∏—Ä–µ–∫—Ç–∞

```bash
# HTTP –¥–æ–ª–∂–µ–Ω —Ä–µ–¥–∏—Ä–µ–∫—Ç–∏—Ç—å –Ω–∞ HTTPS
curl -I http://nettyan.ru
# –î–æ–ª–∂–Ω–æ –≤–µ—Ä–Ω—É—Ç—å: Location: https://nettyan.ru
```

### –ü—Ä–æ–≤–µ—Ä–∫–∞ API

```bash
# –ü—Ä–æ–≤–µ—Ä–∏—Ç—å health endpoint
curl https://nettyan.ru/health

# –î–æ–ª–∂–Ω–æ –≤–µ—Ä–Ω—É—Ç—å:
# {"status":"OK","timestamp":"...","service":"AgiCraft Backend API"}
```

### –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç–∞

Online –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç:
https://www.ssllabs.com/ssltest/analyze.html?d=nettyan.ru

–î–æ–ª–∂–Ω–∞ –±—ã—Ç—å –æ—Ü–µ–Ω–∫–∞ **A** –∏–ª–∏ **A+**.

---

## –®–∞–≥ 9: –ù–∞—Å—Ç—Ä–æ–π–∫–∞ YooKassa webhook

–ü–æ—Å–ª–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ HTTPS –Ω—É–∂–Ω–æ –æ–±–Ω–æ–≤–∏—Ç—å webhook URL –≤ YooKassa.

### –í –ª–∏—á–Ω–æ–º –∫–∞–±–∏–Ω–µ—Ç–µ YooKassa

1. –í–æ–π—Ç–∏: https://yookassa.ru/
2. –ü–µ—Ä–µ–π—Ç–∏: **–ù–∞—Å—Ç—Ä–æ–π–∫–∏ ‚Üí HTTP-—É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è**
3. –î–æ–±–∞–≤–∏—Ç—å URL: `https://nettyan.ru/api/payment/webhook`
4. –í—ã–±—Ä–∞—Ç—å —Å–æ–±—ã—Ç–∏—è:
   - ‚úÖ `payment.succeeded`
   - ‚úÖ `payment.canceled`
5. –°–æ—Ö—Ä–∞–Ω–∏—Ç—å

### –ü—Ä–æ–≤–µ—Ä–∫–∞ webhook

**–°–æ–∑–¥–∞—Ç—å —Ç–µ—Å—Ç–æ–≤—ã–π –ø–ª–∞—Ç—ë–∂:**

```bash
curl -X POST https://nettyan.ru/api/payment/create \
  -H "Content-Type: application/json" \
  -H "Authorization: Bearer YOUR_JWT_TOKEN" \
  -d '{"product_id": 1}'
```

Webhook –¥–æ–ª–∂–µ–Ω —Å—Ä–∞–±–æ—Ç–∞—Ç—å –ø–æ—Å–ª–µ –æ–ø–ª–∞—Ç—ã.

---

## –£—Å—Ç—Ä–∞–Ω–µ–Ω–∏–µ –ø—Ä–æ–±–ª–µ–º

### –ü—Ä–æ–±–ª–µ–º–∞ 1: DNS –Ω–µ –æ–±–Ω–æ–≤–∏–ª—Å—è

**–°–∏–º–ø—Ç–æ–º—ã:**
- `nslookup nettyan.ru` –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç –Ω–µ–ø—Ä–∞–≤–∏–ª—å–Ω—ã–π IP
- Caddy –Ω–µ –º–æ–∂–µ—Ç –ø–æ–ª—É—á–∏—Ç—å —Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç

**–†–µ—à–µ–Ω–∏–µ:**
- –ü–æ–¥–æ–∂–¥–∞—Ç—å 1-24 —á–∞—Å–∞
- –ü—Ä–æ–≤–µ—Ä–∏—Ç—å A-–∑–∞–ø–∏—Å–∏ –≤ reg.ru
- –û—á–∏—Å—Ç–∏—Ç—å DNS –∫–µ—à:

**Windows:**
```bash
ipconfig /flushdns
```

**Linux/Mac:**
```bash
sudo systemd-resolve --flush-caches
```

### –ü—Ä–æ–±–ª–µ–º–∞ 2: –ü–æ—Ä—Ç 80 –∑–∞–±–ª–æ–∫–∏—Ä–æ–≤–∞–Ω –ø—Ä–æ–≤–∞–π–¥–µ—Ä–æ–º

**–°–∏–º–ø—Ç–æ–º—ã:**
- –ü–æ—Ä—Ç 443 —Ä–∞–±–æ—Ç–∞–µ—Ç, –Ω–æ 80 –Ω–µ—Ç
- Let's Encrypt challenge –Ω–µ –ø—Ä–æ—Ö–æ–¥–∏—Ç

**–†–µ—à–µ–Ω–∏–µ:**
- –ù–µ–∫–æ—Ç–æ—Ä—ã–µ –ø—Ä–æ–≤–∞–π–¥–µ—Ä—ã –±–ª–æ–∫–∏—Ä—É—é—Ç –ø–æ—Ä—Ç 80
- –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ DNS-01 challenge –≤–º–µ—Å—Ç–æ HTTP-01

**–ò–∑–º–µ–Ω–∏—Ç—å Caddyfile:**

```caddyfile
{$DOMAIN:localhost} {
    tls {
        dns cloudflare {env.CLOUDFLARE_API_TOKEN}
    }
    # ...
}
```

–¢—Ä–µ–±—É–µ—Ç Cloudflare DNS.

### –ü—Ä–æ–±–ª–µ–º–∞ 3: Mixed Content (HTTP/HTTPS)

**–°–∏–º–ø—Ç–æ–º—ã:**
- –°–∞–π—Ç –æ—Ç–∫—Ä—ã–≤–∞–µ—Ç—Å—è, –Ω–æ –Ω–µ–∫–æ—Ç–æ—Ä—ã–µ —Ä–µ—Å—É—Ä—Å—ã –Ω–µ –∑–∞–≥—Ä—É–∂–∞—é—Ç—Å—è
- Console –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç: "Mixed Content: The page was loaded over HTTPS..."

**–†–µ—à–µ–Ω–∏–µ:**

–ü—Ä–æ–≤–µ—Ä–∏—Ç—å frontend:

```javascript
// –ù–ï –¥–µ–ª–∞–π—Ç–µ —Ç–∞–∫:
const API_URL = 'http://nettyan.ru/api';

// –ü—Ä–∞–≤–∏–ª—å–Ω–æ (–æ—Ç–Ω–æ—Å–∏—Ç–µ–ª—å–Ω—ã–π –ø—É—Ç—å):
const API_URL = '/api';
```

### –ü—Ä–æ–±–ª–µ–º–∞ 4: Backend CORS –æ—à–∏–±–∫–∞

**–°–∏–º–ø—Ç–æ–º—ã:**
- Frontend –Ω–µ –º–æ–∂–µ—Ç –æ–±—Ä–∞—Ç–∏—Ç—å—Å—è –∫ backend
- Console: "CORS policy blocked"

**–†–µ—à–µ–Ω–∏–µ:**

–ü—Ä–æ–≤–µ—Ä–∏—Ç—å `backend/src/server.js`:

```javascript
app.use(cors({
  origin: process.env.FRONTEND_URL || 'http://localhost',
  credentials: true
}));
```

–£–±–µ–¥–∏—Ç—å—Å—è —á—Ç–æ `.env` —Å–æ–¥–µ—Ä–∂–∏—Ç:
```env
FRONTEND_URL=https://nettyan.ru
```

### –ü—Ä–æ–±–ª–µ–º–∞ 5: Caddy –Ω–µ —Å—Ç–∞—Ä—Ç—É–µ—Ç

**–°–∏–º–ø—Ç–æ–º—ã:**
```
Error: loading initial config: loading new config: http app module: start: listen tcp :80: bind: address already in use
```

**–ü—Ä–∏—á–∏–Ω–∞:** –ü–æ—Ä—Ç 80 —É–∂–µ –∑–∞–Ω—è—Ç –¥—Ä—É–≥–∏–º —Å–µ—Ä–≤–∏—Å–æ–º (Apache, Nginx, IIS)

**–†–µ—à–µ–Ω–∏–µ:**

**Windows:**
```bash
# –ù–∞–π—Ç–∏ –ø—Ä–æ—Ü–µ—Å—Å –Ω–∞ –ø–æ—Ä—Ç—É 80
netstat -ano | findstr :80

# –ó–∞–≤–µ—Ä—à–∏—Ç—å –ø—Ä–æ—Ü–µ—Å—Å (–∑–∞–º–µ–Ω–∏—Ç–µ PID)
taskkill /PID 1234 /F
```

**Linux:**
```bash
# –ù–∞–π—Ç–∏ –ø—Ä–æ—Ü–µ—Å—Å
sudo lsof -i :80

# –û—Å—Ç–∞–Ω–æ–≤–∏—Ç—å Apache/Nginx
sudo systemctl stop apache2
sudo systemctl stop nginx
```

---

## –û–±—Å–ª—É–∂–∏–≤–∞–Ω–∏–µ

### –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç–æ–≤

Caddy –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –æ–±–Ω–æ–≤–ª—è–µ—Ç —Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç—ã –∑–∞ 30 –¥–Ω–µ–π –¥–æ –∏—Å—Ç–µ—á–µ–Ω–∏—è.

–ü—Ä–æ–≤–µ—Ä–∏—Ç—å —Å—Ä–æ–∫ –¥–µ–π—Å—Ç–≤–∏—è:

```bash
docker exec agicraft_caddy caddy list-certificates
```

### Backup —Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç–æ–≤

```bash
# –†–µ–∑–µ—Ä–≤–Ω–∞—è –∫–æ–ø–∏—è —Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç–æ–≤
tar -czf caddy-certs-backup-$(date +%Y%m%d).tar.gz caddy/data/

# –í–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏–µ
tar -xzf caddy-certs-backup-20250110.tar.gz
```

### –õ–æ–≥–∏ Caddy

```bash
# –ü—Ä–æ—Å–º–æ—Ç—Ä –ª–æ–≥–æ–≤
docker-compose logs -f caddy

# –õ–æ–≥–∏ –≤ —Ñ–∞–π–ª–µ
tail -f caddy/logs/access.log
```

### –ü–µ—Ä–µ–∑–∞–ø—É—Å–∫ Caddy

```bash
# Graceful reload (–±–µ–∑ downtime)
docker exec agicraft_caddy caddy reload --config /etc/caddy/Caddyfile

# –ò–ª–∏ —á–µ—Ä–µ–∑ docker-compose
docker-compose restart caddy
```

---

## –õ–æ–∫–∞–ª—å–Ω–∞—è —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∞ (–±–µ–∑ HTTPS)

–î–ª—è –ª–æ–∫–∞–ª—å–Ω–æ–π —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏ –º–æ–∂–Ω–æ —Ä–∞–±–æ—Ç–∞—Ç—å –±–µ–∑ Caddy:

```bash
# –ó–∞–ø—É—Å—Ç–∏—Ç—å –±–µ–∑ Caddy
docker-compose up -d postgres velocity survival airesearch lobby backend frontend

# Frontend –¥–æ—Å—Ç—É–ø–µ–Ω –Ω–∞: http://localhost:80
# Backend –¥–æ—Å—Ç—É–ø–µ–Ω –Ω–∞: http://localhost:3000
```

**–ò–ª–∏ –∏–∑–º–µ–Ω–∏—Ç—å docker-compose.yml:**

```yaml
frontend:
  ports:
    - "80:80"  # –†–∞—Å–∫–æ–º–º–µ–Ω—Ç–∏—Ä–æ–≤–∞—Ç—å –¥–ª—è –ª–æ–∫–∞–ª—å–Ω–æ–π —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏
  # expose:
  #   - "80"  # –ó–∞–∫–æ–º–º–µ–Ω—Ç–∏—Ä–æ–≤–∞—Ç—å
```

---

## –ß–µ–∫-–ª–∏—Å—Ç –ø–µ—Ä–µ–¥ –∑–∞–ø—É—Å–∫–æ–º –≤ production

- [ ] –î–æ–º–µ–Ω –∫—É–ø–ª–µ–Ω –Ω–∞ reg.ru (–∏–ª–∏ –∞–Ω–∞–ª–æ–≥–µ)
- [ ] DNS A-–∑–∞–ø–∏—Å–∏ –Ω–∞—Å—Ç—Ä–æ–µ–Ω—ã (@ –∏ www)
- [ ] DNS –æ–±–Ω–æ–≤–∏–ª—Å—è (–ø—Ä–æ–≤–µ—Ä–∏—Ç—å —á–µ—Ä–µ–∑ nslookup)
- [ ] –ü–æ—Ä—Ç—ã 80, 443 –æ—Ç–∫—Ä—ã—Ç—ã –Ω–∞ —Ä–æ—É—Ç–µ—Ä–µ
- [ ] `.env` —Ñ–∞–π–ª –Ω–∞—Å—Ç—Ä–æ–µ–Ω —Å —Ä–µ–∞–ª—å–Ω—ã–º –¥–æ–º–µ–Ω–æ–º
- [ ] LETSENCRYPT_EMAIL —É–∫–∞–∑–∞–Ω —Ä–µ–∞–ª—å–Ω—ã–π
- [ ] –í—Å–µ –ø–∞—Ä–æ–ª–∏ –∏–∑–º–µ–Ω–µ–Ω—ã (POSTGRES, JWT, RCON)
- [ ] YooKassa –Ω–∞—Å—Ç—Ä–æ–µ–Ω (SHOP_ID, SECRET_KEY)
- [ ] Backend CORS –Ω–∞—Å—Ç—Ä–æ–µ–Ω –Ω–∞ —Ä–µ–∞–ª—å–Ω—ã–π –¥–æ–º–µ–Ω
- [ ] Caddy —É—Å–ø–µ—à–Ω–æ –∑–∞–ø—É—â–µ–Ω –∏ –ø–æ–ª—É—á–∏–ª —Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç
- [ ] HTTPS —Ä–∞–±–æ—Ç–∞–µ—Ç (–∑–∞–º–æ–∫ üîí –≤ –±—Ä–∞—É–∑–µ—Ä–µ)
- [ ] YooKassa webhook –æ–±–Ω–æ–≤–ª—ë–Ω –Ω–∞ HTTPS URL
- [ ] –°–¥–µ–ª–∞–Ω backup —Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç–æ–≤

---

## –ò—Ç–æ–≥–æ–≤–∞—è –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞

```
Internet
    ‚Üì
Router (Ports: 80, 443, 25565)
    ‚Üì
Caddy (HTTPS Reverse Proxy)
    ‚îú‚îÄ> Frontend (React SPA)
    ‚îî‚îÄ> Backend (Express API)
         ‚Üì
    PostgreSQL
    Minecraft Servers (Velocity, Survival, AI Research, Lobby)
```

**–ü–æ—Ä—Ç—ã:**
- **80 (HTTP)** ‚Üí Caddy ‚Üí —Ä–µ–¥–∏—Ä–µ–∫—Ç –Ω–∞ 443
- **443 (HTTPS)** ‚Üí Caddy ‚Üí Frontend / Backend
- **8080 (HTTP)** ‚Üí Caddy ‚Üí —Ä–µ–¥–∏—Ä–µ–∫—Ç –Ω–∞ 443 (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)
- **25565 (Minecraft)** ‚Üí Velocity (–ø—Ä—è–º–æ–µ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ)

---

## –ü–æ–ª–µ–∑–Ω—ã–µ —Å—Å—ã–ª–∫–∏

- **Let's Encrypt:** https://letsencrypt.org/
- **Caddy –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è:** https://caddyserver.com/docs/
- **reg.ru:** https://www.reg.ru/
- **SSL Labs —Ç–µ—Å—Ç:** https://www.ssllabs.com/ssltest/
- **–ü—Ä–æ–≤–µ—Ä–∫–∞ –ø–æ—Ä—Ç–æ–≤:** https://www.yougetsignal.com/tools/open-ports/
- **DNS –ø—Ä–æ–≤–µ—Ä–∫–∞:** https://www.whatsmydns.net/

---

## –°—Ç–æ–∏–º–æ—Å—Ç—å

- **–î–æ–º–µ–Ω .ru:** ~140‚ÇΩ/–≥–æ–¥ (reg.ru)
- **SSL —Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç:** –ë–µ—Å–ø–ª–∞—Ç–Ω–æ (Let's Encrypt)
- **Caddy:** –ë–µ—Å–ø–ª–∞—Ç–Ω–æ (open source)

**–ò—Ç–æ–≥–æ:** ~140‚ÇΩ/–≥–æ–¥ –¥–ª—è –ø–æ–ª–Ω–æ–≥–æ HTTPS

---

**–í–æ–ø—Ä–æ—Å—ã?** –°–æ–∑–¥–∞–π—Ç–µ issue –Ω–∞ GitHub –∏–ª–∏ –ø–∏—à–∏—Ç–µ –≤ Discord: discord.gg/agicraft
